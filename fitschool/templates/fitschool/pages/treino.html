{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treinos - FitSchool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/styleTreino.css' %}">
</head>
<body>
    
    <aside class="sidebar">
        <div class="logo">
            <h1>Fitschool</h1>
        </div>

        <div class="user-info">
            <div class="avatar">{{ user.username|first|upper }}</div>
            <div class="user-details">
                <h3>{{ user.username }}</h3>
                <p>{{ user.email }}</p>
            </div>
        </div>

        <ul class="menu">
            <li><a href="{% url 'menu' %}"><i class="fa-solid fa-table-columns"></i> Dashboard</a></li>
            <li><a href="{% url 'perfil_usuario' %}"><i class="fas fa-user"></i> Meu Perfil</a></li>
            <li><a href="{% url 'meus_treinos' %}" class="active"><i class="fas fa-dumbbell"></i> Meus Treinos</a></li>
            <li><a href="{% url 'frequencia' %}"><i class="fas fa-calendar-check"></i> Frequência</a></li>
            <li><a href="{% url 'listar_notificacoes' %}"><i class="fas fa-bell"></i> Notificações</a></li>
            <li><a href="#"><i class="fas fa-chalkboard-teacher"></i> Professores</a></li>
        </ul>
    </aside>

    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">Meus Treinos</h1>
            
            <div class="header-actions">
                <a href="{% url 'meus_treinos' %}" class="btn btn-primary">Todos</a>
                <a href="{% url 'meus_treinos' %}?filtro=favoritos" class="btn btn-primary">Favoritos</a>
                <button class="btn btn-primary" onclick="showAddWorkoutModal()">
                    <i class="fas fa-plus"></i> Novo Treino
                </button>
            </div>
            </div>

        <div class="workout-list">
            {% if treinos %}
                {% for treino in treinos %}
                <div class="workout-card" data-treino-id="{{ treino.id }}">
                    <div class="workout-header">
                        <h3 class="workout-title">{{ treino.nome }}</h3>
                        <span class="workout-type">{{ treino.tipo|title }}</span>
                    </div>

                    <div class="workout-body">
                        <div class="workout-detail"><span>Dia:</span><span>{{ treino.dia_semana|title }}</span></div>
                        <div class="workout-detail"><span>Duração:</span><span>{{ treino.duracao }} min</span></div>
                        <div class="workout-detail"><span>Observações:</span><span>{{ treino.observacoes|default:"—" }}</span></div>
                    </div>

                    <div class="workout-exercises">
                        <h4>Exercícios</h4>
                        <ul>
                            {% for exercicio in treino.exercicios.all %}
                                <li data-exercicio-id="{{ exercicio.id }}">
                                    {{ exercicio.nome }} — {{ exercicio.series }}x{{ exercicio.repeticoes }}
                                    {% if exercicio.carga %}
                                        ({{ exercicio.carga }})
                                    {% endif %}
                                </li>
                            {% empty %}
                                <li><em>Nenhum exercício cadastrado.</em></li>
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="workout-footer">
                        <div class="workout-actions">
                            
                            <button class="btn-icon-favorite {% if treino.favorito %}is-favorito{% endif %}" 
                                    title="Favoritar treino" 
                                    data-treino-id="{{ treino.id }}">
                                <i class="{% if treino.favorito %}fas{% else %}far{% endif %} fa-star"></i>
                            </button>
                            <form action="{% url 'excluir_treino' treino.id %}" method="post" style="display:inline;" onsubmit="return confirmarExclusao('{{ treino.nome }}')">
                                {% csrf_token %}
                                <button type="submit" class="btn-icon" title="Excluir treino">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                            
                            <button class="btn-icon-edit" 
                                    title="Editar treino"
                                    data-treino-id="{{ treino.id }}"
                                    data-action-url="{% url 'editar_treino' treino.id %}">
                                <i class="fas fa-pen"></i>
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-dumbbell"></i>
                    {% if filtro_ativo == 'favoritos' %}
                        <p>Nenhum treino favorito encontrado.</p>
                    {% else %}
                        <p>Nenhum treino cadastrado ainda.</p>
                    {% endif %}
                </div>
                {% endif %}
        </div>

        <div class="modal" id="addWorkoutModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Adicionar Novo Treino</h2>
                    <span class="close" onclick="closeModal('addWorkoutModal')">&times;</span>
                </div>
                <form method="POST" action="{% url 'meus_treinos' %}">
                    {% csrf_token %}
                    {{ exercicio_formset.management_form }}
                    <div class="form-group"><label>Nome do Treino</label>{{ form.nome }}</div>
                    <div class="form-row">
                        <div class="form-group"><label>Tipo</label>{{ form.tipo }}</div>
                        <div class="form-group"><label>Dia</label>{{ form.dia_semana }}</div>
                    </div>
                    <div class="form-group"><label>Duração (minutos)</label>{{ form.duracao }}</div>
                    <div class="form-group"><label>Observações</label>{{ form.observacoes }}</div>

                    <h3>Exercícios</h3>
                    <div id="exercise-container">
                        {% for exercicio_form in exercicio_formset %}
                        <div class="exercise-form">
                            <div class="form-row">
                                <div class="form-group"><label>Nome</label>{{ exercicio_form.nome }}</div>
                                <div class="form-group"><label>Séries</label>{{ exercicio_form.series }}</div>
                                <div class="form-group"><label>Repetições</label>{{ exercicio_form.repeticoes }}</div>
                                <div class="form-group"><label>Carga</label>{{ exercicio_form.carga }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button type="button" id="add-exercise-btn" class="add-exercise-btn"><i class="fas fa-plus"></i> Adicionar Exercício</button>
                    <button type="submit" class="btn btn-primary" style="width:100%;">Salvar Treino</button>
                </form>
            </div>
        </div>

        <div class="modal" id="editWorkoutModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Editar Treino</h2>
                    <span class="close" onclick="closeModal('editWorkoutModal')">&times;</span>
                </div>
                <form id="editWorkoutForm" method="POST">
                    {% csrf_token %}
                    {{ exercicio_formset.management_form }}
                    <div class="form-group"><label for="edit_nome">Nome</Do Treino</label><input type="text" name="nome" id="edit_nome"></div>
                    <div class="form-row">
                        <div class="form-group"><label for="edit_tipo">Tipo</label><input type="text" name="tipo" id="edit_tipo"></div>
                        <div class="form-group"><label for="edit_dia_semana">Dia</Dae</label><input type="text" name="dia_semana" id="edit_dia_semana"></div>
                    </div>
                    <div class="form-group"><label for="edit_duracao">Duração</label><input type="number" name="duracao" id="edit_duracao"></div>
                    <div class="form-group"><label for="edit_observacoes">Observações</label><textarea name="observacoes" id="edit_observacoes"></textarea></div>

                    <h3>Exercícios</h3>
                    <div id="edit-exercise-container"></div>
                    
                    <button type="submit" class="btn btn-primary" style="width:100%;">Salvar Alterações</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function confirmarExclusao(nomeTreino) {
            return confirm(`Tem certeza que deseja excluir o treino "${nomeTreino}"?`);
        }
    </script>
    <script src="{% static 'js/script.js' %}"></script>
</body>
</html>